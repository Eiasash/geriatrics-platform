<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Three Critical Fixes</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f0f2f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .test-section { margin-bottom: 30px; padding: 20px; border-left: 4px solid #667eea; background-color: #f8f9ff; }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .info { color: #17a2b8; font-weight: bold; }
        input, select, button { margin: 10px 0; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #667eea; color: white; cursor: pointer; font-weight: bold; }
        button:hover { background: #5a67d8; }
        .result-box { margin: 15px 0; padding: 15px; background: #e7f3ff; border-radius: 8px; border: 1px solid #667eea; }
        .protocol-card { background: white; padding: 15px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .calc-input { display: flex; align-items: center; gap: 10px; margin: 10px 0; }
        .calc-result { background: #d4edda; padding: 15px; border-radius: 8px; margin: 15px 0; border: 1px solid #28a745; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Testing Three Critical Fixes</h1>
        <p>This page tests the three critical fixes: medication typo tolerance, clinical protocols, and calculators.</p>
        
        <!-- Test 1: Medication Fuzzy Matching -->
        <div class="test-section">
            <h2>1Ô∏è‚É£ Medication Typo Tolerance Test</h2>
            <p>Test fuzzy matching for medication names with common typos and variations.</p>
            
            <label>Search medication (try typos like "coumadine", "eliqis", "plaviks"):</label>
            <input type="text" id="medSearch" placeholder="Enter medication name...">
            <button onclick="testMedicationSearch()">Search</button>
            
            <div id="medResults"></div>
        </div>

        <!-- Test 2: Clinical Protocols -->
        <div class="test-section">
            <h2>2Ô∏è‚É£ Clinical Protocols Test</h2>
            <p>Test access to 8+ clinical protocols for geriatric conditions.</p>
            
            <button onclick="testProtocols()">Load All Protocols</button>
            
            <div id="protocolResults"></div>
        </div>

        <!-- Test 3: Clinical Calculators -->
        <div class="test-section">
            <h2>3Ô∏è‚É£ Clinical Calculators Test</h2>
            <p>Test 10 clinical calculators with proper scoring.</p>
            
            <div style="margin-bottom: 20px;">
                <h3>MMSE Calculator Test</h3>
                <div class="calc-input">
                    <label>Orientation (0-10):</label>
                    <input type="number" id="mmse1" min="0" max="10" value="8">
                </div>
                <div class="calc-input">
                    <label>Registration (0-3):</label>
                    <input type="number" id="mmse2" min="0" max="3" value="3">
                </div>
                <div class="calc-input">
                    <label>Attention (0-5):</label>
                    <input type="number" id="mmse3" min="0" max="5" value="3">
                </div>
                <div class="calc-input">
                    <label>Recall (0-3):</label>
                    <input type="number" id="mmse4" min="0" max="3" value="1">
                </div>
                <div class="calc-input">
                    <label>Language (0-9):</label>
                    <input type="number" id="mmse5" min="0" max="9" value="7">
                </div>
                <button onclick="testMMSE()">Calculate MMSE</button>
                <div id="mmseResult"></div>
            </div>

            <div>
                <h3>Morse Fall Scale Test</h3>
                <div class="calc-input">
                    <label><input type="checkbox" id="fallHistory"> Fall in past 3 months</label>
                </div>
                <div class="calc-input">
                    <label><input type="checkbox" id="secondary"> Secondary diagnosis</label>
                </div>
                <div class="calc-input">
                    <label>Ambulatory aid:</label>
                    <select id="aid">
                        <option value="none">None</option>
                        <option value="crutches">Crutches/Walker</option>
                        <option value="furniture">Furniture</option>
                    </select>
                </div>
                <div class="calc-input">
                    <label><input type="checkbox" id="iv"> IV/Heparin lock</label>
                </div>
                <div class="calc-input">
                    <label>Gait:</label>
                    <select id="gait">
                        <option value="normal">Normal</option>
                        <option value="weak">Weak</option>
                        <option value="impaired">Impaired</option>
                    </select>
                </div>
                <div class="calc-input">
                    <label><input type="checkbox" id="mental"> Overestimates ability</label>
                </div>
                <button onclick="testMorseFall()">Calculate Morse Fall Scale</button>
                <div id="morseResult"></div>
            </div>
            
            <button onclick="testAllCalculators()" style="margin-top: 20px; background: #28a745;">Test All 10 Calculators</button>
            <div id="allCalcResults"></div>
        </div>
    </div>

    <script type="module">
        // Import the modules (simulating the React app imports)
        import { medicationDatabase } from './src/data/medications.js';
        import MedicationMatcher from './src/utils/medicationMatcher.js';
        import protocols from './src/data/protocols.js';
        import ClinicalCalculators from './src/utils/clinicalCalculators.js';

        // Make available globally for testing
        window.medicationDatabase = medicationDatabase;
        window.MedicationMatcher = MedicationMatcher;
        window.protocols = protocols;
        window.ClinicalCalculators = ClinicalCalculators;

        console.log('‚úÖ All modules loaded successfully');
        console.log('üìö Medication database:', medicationDatabase?.length, 'medications');
        console.log('üìã Protocols:', Object.keys(protocols).length, 'protocols');
        console.log('üßÆ Calculators:', Object.keys(ClinicalCalculators).length, 'calculators');
    </script>

    <script>
        // Test medication search with fuzzy matching
        function testMedicationSearch() {
            const query = document.getElementById('medSearch').value;
            const resultsDiv = document.getElementById('medResults');
            
            if (!query) {
                resultsDiv.innerHTML = '<div class="error">Please enter a medication name to search.</div>';
                return;
            }

            console.log('üîç Searching for:', query);
            
            try {
                const results = window.MedicationMatcher.searchMedications(query, window.medicationDatabase, 5);
                
                if (results.length === 0) {
                    resultsDiv.innerHTML = `<div class="error">No matches found for "${query}"</div>`;
                    return;
                }

                let html = `<div class="result-box"><h4>Search Results for "${query}":</h4>`;
                results.forEach((result, index) => {
                    const med = result.medication;
                    const confidenceColor = result.confidence === 'high' ? '#28a745' : 
                                          result.confidence === 'medium' ? '#ffc107' : '#17a2b8';
                    
                    html += `
                        <div style="border-left: 4px solid ${confidenceColor}; padding: 10px; margin: 10px 0; background: #f8f9fa;">
                            <strong>${med.name}</strong> ${med.heName ? '(' + med.heName + ')' : ''}
                            <br><small>Brand: ${med.brand || med.israeliBrand || 'N/A'}</small>
                            <br><small>Match: ${Math.round(result.score * 100)}% (${result.confidence})</small>
                        </div>
                    `;
                });
                html += '</div>';
                
                resultsDiv.innerHTML = html;
                console.log('‚úÖ Found', results.length, 'matches');
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
                console.error('‚ùå Search error:', error);
            }
        }

        // Test protocols loading
        function testProtocols() {
            const resultsDiv = document.getElementById('protocolResults');
            
            try {
                const protocolNames = Object.keys(window.protocols);
                console.log('üìã Loading protocols:', protocolNames);
                
                let html = `<div class="result-box"><h4>Available Protocols (${protocolNames.length}):</h4>`;
                
                protocolNames.forEach(name => {
                    const protocol = window.protocols[name];
                    html += `
                        <div class="protocol-card">
                            <h5>${protocol.title}</h5>
                            <p>${protocol.description}</p>
                            <small>Steps: ${protocol.steps ? protocol.steps.length : 'N/A'}</small>
                        </div>
                    `;
                });
                
                html += '</div>';
                resultsDiv.innerHTML = html;
                
                console.log('‚úÖ Loaded', protocolNames.length, 'protocols');
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">Error loading protocols: ${error.message}</div>`;
                console.error('‚ùå Protocol error:', error);
            }
        }

        // Test MMSE calculator
        function testMMSE() {
            const resultsDiv = document.getElementById('mmseResult');
            
            try {
                const scores = [
                    parseInt(document.getElementById('mmse1').value) || 0,
                    parseInt(document.getElementById('mmse2').value) || 0,
                    parseInt(document.getElementById('mmse3').value) || 0,
                    parseInt(document.getElementById('mmse4').value) || 0,
                    parseInt(document.getElementById('mmse5').value) || 0
                ];
                
                const result = window.ClinicalCalculators.MMSE.calculate(scores);
                
                resultsDiv.innerHTML = `
                    <div class="calc-result">
                        <h4>MMSE Result:</h4>
                        <p><strong>Score:</strong> ${result.score}/30</p>
                        <p><strong>Interpretation:</strong> ${result.interpretation}</p>
                        <p><strong>Recommendation:</strong> ${result.recommendation}</p>
                    </div>
                `;
                
                console.log('‚úÖ MMSE calculated:', result);
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">MMSE calculation error: ${error.message}</div>`;
                console.error('‚ùå MMSE error:', error);
            }
        }

        // Test Morse Fall Scale
        function testMorseFall() {
            const resultsDiv = document.getElementById('morseResult');
            
            try {
                const items = {
                    history: document.getElementById('fallHistory').checked,
                    secondary: document.getElementById('secondary').checked,
                    aid: document.getElementById('aid').value,
                    iv: document.getElementById('iv').checked,
                    gait: document.getElementById('gait').value,
                    overestimatesAbility: document.getElementById('mental').checked
                };
                
                const result = window.ClinicalCalculators.MorseFallScale.calculate(items);
                
                resultsDiv.innerHTML = `
                    <div class="calc-result">
                        <h4>Morse Fall Scale Result:</h4>
                        <p><strong>Score:</strong> ${result.score} points</p>
                        <p><strong>Risk Level:</strong> ${result.risk}</p>
                        <p><strong>Recommendation:</strong> ${result.recommendation}</p>
                        <div>
                            <strong>Interventions:</strong>
                            <ul>
                                ${result.interventions.map(i => `<li>${i}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;
                
                console.log('‚úÖ Morse Fall Scale calculated:', result);
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">Morse Fall Scale error: ${error.message}</div>`;
                console.error('‚ùå Morse error:', error);
            }
        }

        // Test all calculators
        function testAllCalculators() {
            const resultsDiv = document.getElementById('allCalcResults');
            
            try {
                const calculators = Object.keys(window.ClinicalCalculators);
                
                let html = `<div class="result-box"><h4>All Clinical Calculators (${calculators.length}):</h4>`;
                
                calculators.forEach(calcName => {
                    const calc = window.ClinicalCalculators[calcName];
                    html += `
                        <div style="border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 4px;">
                            <strong>${calc.name}</strong><br>
                            <small>${calc.description}</small><br>
                            <span class="success">‚úÖ Available</span>
                        </div>
                    `;
                });
                
                html += '</div>';
                resultsDiv.innerHTML = html;
                
                console.log('‚úÖ All', calculators.length, 'calculators verified');
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">Error testing calculators: ${error.message}</div>`;
                console.error('‚ùå Calculator test error:', error);
            }
        }

        // Auto-run basic tests on load
        window.addEventListener('load', function() {
            console.log('üöÄ Running basic tests...');
            
            setTimeout(() => {
                // Test medication search with "coumadine"
                document.getElementById('medSearch').value = 'coumadine';
                testMedicationSearch();
                
                // Load protocols
                testProtocols();
                
                // Test all calculators
                testAllCalculators();
                
                console.log('üéâ Basic tests completed!');
            }, 1000);
        });
    </script>
</body>
</html>
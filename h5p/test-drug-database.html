<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Israeli Drug Database Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            color: #1e3a8a;
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .result {
            background: #f0f9ff;
            padding: 15px;
            border-left: 4px solid #3b82f6;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        .success {
            border-left-color: #10b981;
            background: #f0fdf4;
        }
        .warning {
            border-left-color: #f59e0b;
            background: #fffbeb;
        }
        .error {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #2563eb;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>üáÆüá± Israeli Drug Database Testing Suite</h1>
    
    <div class="test-section">
        <h2>1. Hebrew Medication Search Test</h2>
        <input type="text" id="hebrew-search" placeholder="Try: ◊ê◊ß◊û◊ï◊ú, ◊§◊®◊û◊ô◊ü, ◊ß◊ï◊û◊ì◊ô◊ü, ◊ï◊ê◊ú◊ô◊ï◊ù, ◊®◊ô◊ë◊ï◊ò◊®◊ô◊ú" />
        <button onclick="testHebrewSearch()">Search Hebrew</button>
        <div id="hebrew-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>2. Brand Name Search Test</h2>
        <input type="text" id="brand-search" placeholder="Try: Tritace, Norvasc, Zoloft, Augmentin" />
        <button onclick="testBrandSearch()">Search Brand</button>
        <div id="brand-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>3. Drug Interaction Test</h2>
        <textarea id="interaction-drugs" rows="4" placeholder="Enter medications (one per line):
warfarin
amiodarone
aspirin"></textarea>
        <button onclick="testInteractions()">Check Interactions</button>
        <div id="interaction-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>4. STOPP/START Criteria Test</h2>
        <textarea id="medication-list" rows="4" placeholder="Enter medications:
diazepam
omeprazole
metoclopramide"></textarea>
        <button onclick="testSTOPPCriteria()">Check STOPP Criteria</button>
        <div id="stopp-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>5. Beers Criteria Test</h2>
        <input type="text" id="beers-drug" placeholder="Try: diazepam, clonazepam, diphenhydramine" />
        <button onclick="testBeersCriteria()">Check Beers</button>
        <div id="beers-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>6. Sal Coverage Test</h2>
        <input type="text" id="sal-drug" placeholder="Try: apixaban, empagliflozin, donepezil" />
        <button onclick="testSalCoverage()">Check Coverage</button>
        <div id="sal-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>7. Comprehensive Medication Review</h2>
        <input type="number" id="patient-age" placeholder="Age (e.g., 82)" value="82" />
        <input type="number" id="patient-creat" placeholder="Creatinine (e.g., 1.5)" value="1.5" />
        <textarea id="review-meds" rows="3" placeholder="Medications">warfarin
metformin
omeprazole
diazepam</textarea>
        <textarea id="review-conditions" rows="2" placeholder="Conditions">atrial fibrillation
diabetes</textarea>
        <button onclick="testComprehensiveReview()">Run Complete Review</button>
        <div id="review-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>Database Statistics</h2>
        <button onclick="showStats()">Show Statistics</button>
        <div id="stats-result" class="result"></div>
    </div>

    <script src="israeli-drug-database.js"></script>
    <script>
        function testHebrewSearch() {
            const query = document.getElementById('hebrew-search').value;
            const result = IsraeliDrugDatabase.searchHebrewMedication(query);
            document.getElementById('hebrew-result').className = result.error ? 'result error' : 'result success';
            document.getElementById('hebrew-result').textContent = JSON.stringify(result, null, 2);
        }

        function testBrandSearch() {
            const query = document.getElementById('brand-search').value;
            const result = IsraeliDrugDatabase.getDrugInfo(query);
            document.getElementById('brand-result').className = result.error ? 'result error' : 'result success';
            document.getElementById('brand-result').textContent = JSON.stringify(result, null, 2);
        }

        function testInteractions() {
            const drugs = document.getElementById('interaction-drugs').value.split('\n').filter(d => d.trim());
            const result = IsraeliDrugDatabase.getInteractionSummary(drugs);
            const element = document.getElementById('interaction-result');
            element.className = result.major > 0 ? 'result error' : result.moderate > 0 ? 'result warning' : 'result success';
            element.textContent = JSON.stringify(result, null, 2);
        }

        function testSTOPPCriteria() {
            const meds = document.getElementById('medication-list').value.split('\n').filter(m => m.trim());
            const result = IsraeliDrugDatabase.checkSTOPPCriteria(meds);
            const element = document.getElementById('stopp-result');
            element.className = result.length > 0 ? 'result warning' : 'result success';
            element.textContent = result.length > 0 ? 
                JSON.stringify(result, null, 2) : 
                'No STOPP criteria violations found';
        }

        function testBeersCriteria() {
            const drug = document.getElementById('beers-drug').value;
            const result = IsraeliDrugDatabase.checkBeersCriteria(drug);
            const element = document.getElementById('beers-result');
            if (result) {
                element.className = result.severity === 'HIGH' ? 'result error' : 'result warning';
                element.textContent = JSON.stringify(result, null, 2);
            } else {
                element.className = 'result success';
                element.textContent = 'No Beers criteria violations';
            }
        }

        function testSalCoverage() {
            const drug = document.getElementById('sal-drug').value;
            const result = IsraeliDrugDatabase.checkSalCoverage(drug);
            const element = document.getElementById('sal-result');
            element.className = result.covered ? 'result success' : 'result warning';
            element.textContent = JSON.stringify(result, null, 2);
        }

        function testComprehensiveReview() {
            const patientData = {
                age: parseInt(document.getElementById('patient-age').value),
                creatinine: parseFloat(document.getElementById('patient-creat').value),
                medications: document.getElementById('review-meds').value.split('\n').filter(m => m.trim()),
                conditions: document.getElementById('review-conditions').value.split('\n').filter(c => c.trim()),
                gender: 'M'
            };
            
            const review = IsraeliDrugDatabase.performComprehensiveMedicationReview(patientData);
            const element = document.getElementById('review-result');
            
            // Format the review nicely
            const summary = {
                'Patient': `Age ${review.patient.age}, eGFR ${review.patient.eGFR} mL/min`,
                'Medications': review.patient.medicationCount,
                'Critical Issues': review.priorityActions.filter(a => a.priority === 1).length,
                'Drug Interactions': `${review.interactions.length} found`,
                'STOPP Violations': review.stoppViolations.length,
                'START Recommendations': review.startRecommendations.length,
                'Beers Violations': review.beersViolations.length,
                'Renal Adjustments Needed': review.renalAdjustments.length,
                'Priority Actions': review.priorityActions.slice(0, 3),
                'Top Recommendations': review.recommendations.slice(0, 2)
            };
            
            element.className = review.priorityActions.some(a => a.priority === 1) ? 'result error' : 'result warning';
            element.textContent = JSON.stringify(summary, null, 2);
        }

        function showStats() {
            const stats = IsraeliDrugDatabase.generateReport();
            document.getElementById('stats-result').className = 'result success';
            document.getElementById('stats-result').textContent = JSON.stringify(stats, null, 2);
        }

        // Auto-run stats on load
        window.onload = function() {
            showStats();
            console.log('üéâ Israeli Drug Database Test Suite Loaded!');
            console.log('Try these in console:');
            console.log('  IsraeliDrugDatabase.searchHebrewMedication("◊ê◊ß◊û◊ï◊ú")');
            console.log('  IsraeliDrugDatabase.getDrugInfo("Tritace")');
            console.log('  IsraeliDrugDatabase.checkInteractions(["warfarin", "amiodarone"])');
        };
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geriatrics Transition PWA</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkdlcmlhdHJpY3MgVHJhbnNpdGlvbiBTeXN0ZW0iLAogICJzaG9ydF9uYW1lIjogIkdlcmlhdHJpY3MiLAogICJkZXNjcmlwdGlvbiI6ICJGYW1pbHkgTWVkaWNpbmUgdG8gR2VyaWF0cmljcyBUcmFuc2l0aW9uIFN5c3RlbSIsCiAgInN0YXJ0X3VybCI6ICIuLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzFhMWEyZSIsCiAgInRoZW1lX2NvbG9yIjogIiM2NjdlZWEiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSTFNVElpSUdobGFXZG9kRDBpTlRFeUlqNEtQSEpsWTNRZ2QybGtkR2c5SWpVeE1pSWdhR1ZwWjJoMFBTSTFNVElpSUdacGJHdzlJaU0yTmpkbFpXRWlMejRLUEhSbGVIUWdlRDBpTWpVMklpQjVQU0l5TlRZaUlIUmxlSFE0WVc1amFHOXlQU0p0YVdSa2JHVWlJR1pwYkd3OUluZG9hWFJsSWo0NE9VZ3NPREk0Tno0OEwzUmxlSFErQ2p3dmMzWm5QZ29nSUNBZ0lDQT0iLAogICAgICAic2l6ZXMiOiAiNTEyeDUxMiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9CiAgXQp9">
    
    <!-- PWA Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:application/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZXZlbnQgPT4gewogIGV2ZW50LndhaXRVbnRpbChzZWxmLnNraXBXYWl0aW5nKCkpOwp9KTsKCnNlbGYuYWRkRXZlbnRMaXN0ZW5lcignYWN0aXZhdGUnLCBldmVudCA9PiB7CiAgZXZlbnQud2FpdFVudGlsKHNlbGYuY2xpZW50cy5jbGFpbSgpKTsKfSk7');
        }
    </script>
    
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            overflow-x: hidden;
            line-height: 1.4;
            min-height: 100vh;
        }
        
        .app-header {
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #333;
        }
        
        .app-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .install-banner {
            background: linear-gradient(45deg, #11998e, #38ef7d);
            color: white;
            padding: 20px;
            margin: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .install-btn {
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }
        
        .install-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .module-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            border-left: 5px solid #667eea;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .module-card:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.15);
        }
        
        .module-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .module-title {
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .board-weight {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .progress-container {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px;
            text-align: center;
        }
        
        .progress-bar {
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 25%;
            transition: width 0.5s ease;
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .action-btn {
            background: rgba(255,255,255,0.15);
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .action-btn:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-2px);
        }
        
        .primary-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            grid-column: 1 / -1;
        }
        
        .israeli-context {
            background: linear-gradient(45deg, #4158d0, #c850c0);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 0.9em;
        }
        
        .footer {
            text-align: center;
            padding: 40px 20px;
            color: #666;
            border-top: 1px solid #333;
            margin-top: 40px;
        }
        
        @media (max-width: 768px) {
            .module-grid {
                grid-template-columns: 1fr;
                padding: 15px;
            }
            
            .module-card {
                padding: 20px;
            }
            
            .app-title {
                font-size: 1.2em;
            }
        }
        
        /* PWA Install Prompt */
        .pwa-prompt {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .pwa-prompt.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .close-prompt {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            color: white;
            font-size: 1.2em;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="app-header">
        <div class="app-title">üè• Geriatrics Transition System</div>
        <div style="font-size: 0.9em; opacity: 0.8;">Family Medicine ‚Üí Geriatrics Subspecialty</div>
    </div>

    <div class="install-banner">
        <h2>üì± Install as Standalone App</h2>
        <p>Get the full native app experience with offline access and notifications</p>
        <button class="install-btn" onclick="installPWA()">üì• Install App</button>
        <button class="install-btn" onclick="showInstructions()">üìã Instructions</button>
    </div>

    <div class="progress-container">
        <h3>Your Transition Progress</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin: 15px 0;">
            <div>
                <div style="font-size: 2em; font-weight: bold; color: #667eea;">25%</div>
                <div style="font-size: 0.8em;">Complete</div>
            </div>
            <div>
                <div style="font-size: 2em; font-weight: bold; color: #4ecdc4;">14</div>
                <div style="font-size: 0.8em;">Weeks Left</div>
            </div>
            <div>
                <div style="font-size: 2em; font-weight: bold; color: #ff6b6b;">85%</div>
                <div style="font-size: 0.8em;">Board Ready</div>
            </div>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>
    </div>

    <div class="module-grid">
        <!-- CGA Module -->
        <div class="module-card" onclick="startModule('cga')">
            <div class="module-header">
                <div class="module-title">üéØ Comprehensive Geriatric Assessment</div>
                <div class="board-weight">30%</div>
            </div>
            <div style="margin-bottom: 15px; opacity: 0.9;">
                Master the 4M framework, functional assessment tools, and MoCA certification
            </div>
            <div class="israeli-context">
                üáÆüá± Israeli Context: Kupat Holim CGA protocols, IMA guidelines, Hebrew terminology
            </div>
            <div class="action-buttons">
                <button class="action-btn" onclick="event.stopPropagation(); quickStudy('cga')">üìñ Quick Study</button>
                <button class="action-btn" onclick="event.stopPropagation(); practiceMode('cga')">üß† Practice</button>
                <button class="primary-btn" onclick="event.stopPropagation(); startModule('cga')">üöÄ Start Module</button>
            </div>
        </div>

        <!-- Delirium Module -->
        <div class="module-card" onclick="startModule('delirium')">
            <div class="module-header">
                <div class="module-title">‚ö° Delirium Recognition</div>
                <div class="board-weight">25%</div>
            </div>
            <div style="margin-bottom: 15px; opacity: 0.9;">
                CAM assessment, 4AT screening, and non-pharmacological interventions
            </div>
            <div class="israeli-context">
                üáÆüá± Israeli Context: Emergency department protocols, cultural considerations
            </div>
            <div class="action-buttons">
                <button class="action-btn" onclick="event.stopPropagation(); quickStudy('delirium')">üìñ Study</button>
                <button class="action-btn" onclick="event.stopPropagation(); practiceCAM()">üîç CAM Test</button>
                <button class="primary-btn" onclick="event.stopPropagation(); startModule('delirium')">üöÄ Start Module</button>
            </div>
        </div>

        <!-- Dementia Module -->
        <div class="module-card" onclick="startModule('dementia')">
            <div class="module-header">
                <div class="module-title">üß† Dementia Management</div>
                <div class="board-weight">30%</div>
            </div>
            <div style="margin-bottom: 15px; opacity: 0.9;">
                MoCA mastery, cholinesterase inhibitors, and behavioral management
            </div>
            <div class="israeli-context">
                üáÆüá± Israeli Context: MoCA Hebrew version, National Insurance coverage
            </div>
            <div class="action-buttons">
                <button class="action-btn" onclick="event.stopPropagation(); quickStudy('dementia')">üìñ Study</button>
                <button class="action-btn" onclick="event.stopPropagation(); practiceMoCA()">üß© MoCA</button>
                <button class="primary-btn" onclick="event.stopPropagation(); startModule('dementia')">üöÄ Start Module</button>
            </div>
        </div>

        <!-- Pharmacology Module -->
        <div class="module-card" onclick="startModule('pharma')">
            <div class="module-header">
                <div class="module-title">üíä Geriatric Pharmacology</div>
                <div class="board-weight">25%</div>
            </div>
            <div style="margin-bottom: 15px; opacity: 0.9;">
                Beers Criteria 2023, deprescribing protocols, and drug interactions
            </div>
            <div class="israeli-context">
                üáÆüá± Israeli Context: Local formulary, Kupat Holim approvals
            </div>
            <div class="action-buttons">
                <button class="action-btn" onclick="event.stopPropagation(); quickStudy('pharma')">üìñ Study</button>
                <button class="action-btn" onclick="event.stopPropagation(); practiceBeers()">‚öóÔ∏è Beers</button>
                <button class="primary-btn" onclick="event.stopPropagation(); startModule('pharma')">üöÄ Start Module</button>
            </div>
        </div>
    </div>

    <!-- PWA Install Prompt -->
    <div class="pwa-prompt" id="pwaPrompt">
        <button class="close-prompt" onclick="closePWAPrompt()">√ó</button>
        <div style="font-weight: bold; margin-bottom: 10px;">üì± Install as App</div>
        <div style="font-size: 0.9em; margin-bottom: 15px;">
            Get offline access, notifications, and native app experience
        </div>
        <button class="install-btn" onclick="installPWA()">Install Now</button>
    </div>

    <div class="footer">
        <div>ü§ñ Automated Learning System for Israeli Geriatrics Boards</div>
        <div style="margin-top: 10px; font-size: 0.8em;">
            Optimized for Family Medicine ‚Üí Geriatrics Transition
        </div>
    </div>

    <script>
        let deferredPrompt;
        let installSource = '';

        // PWA Installation Logic
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            showPWAPrompt();
        });

        function showPWAPrompt() {
            setTimeout(() => {
                document.getElementById('pwaPrompt').classList.add('show');
            }, 3000);
        }

        function closePWAPrompt() {
            document.getElementById('pwaPrompt').classList.remove('show');
        }

        async function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    showNotification('üéâ App Installed!', 'Access from your home screen');
                } else {
                    showNotification('üì± Installation Tips', 'Try adding to home screen manually');
                }
                
                deferredPrompt = null;
            } else {
                showInstructions();
            }
            closePWAPrompt();
        }

        function showInstructions() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);
            
            let instructions = '';
            
            if (isIOS) {
                instructions = `üì± iOS Installation:
                
1. Tap Share button (‚¨ÜÔ∏è)
2. Scroll down and tap "Add to Home Screen"
3. Name it "Geriatrics Study"
4. Tap "Add"

‚úÖ App will appear on your home screen!`;
            } else if (isAndroid) {
                instructions = `ü§ñ Android Installation:
                
1. Tap three dots menu (‚ãÆ)
2. Tap "Add to Home screen"
3. Name it "Geriatrics Study"
4. Tap "Add"

‚úÖ Native app experience enabled!`;
            } else {
                instructions = `üíª Desktop Installation:
                
1. Look for install icon in address bar
2. Click "Install"
3. Or: Menu ‚Üí More Tools ‚Üí Create Shortcut

‚úÖ Desktop app created!`;
            }
            
            alert(instructions);
        }

        // Module Functions
        function startModule(moduleId) {
            updateProgress(10);
            showNotification(`üöÄ Starting ${moduleId} module`, 'Loading Hazzard\'s content...');
            
            // Store progress
            localStorage.setItem(`module_${moduleId}_started`, Date.now());
            
            // In real implementation, this would load the actual content
            setTimeout(() => {
                showNotification('üìö Module Ready', 'Begin your focused study session');
            }, 2000);
        }

        function quickStudy(moduleId) {
            showNotification('üìñ Quick Study Mode', '15-minute focused review session');
            updateProgress(5);
        }

        function practiceMode(moduleId) {
            showNotification('üß† Practice Mode', 'Interactive questions and scenarios');
        }

        function practiceCAM() {
            showNotification('üîç CAM Assessment Practice', 'Learn delirium screening protocols');
        }

        function practiceMoCA() {
            showNotification('üß© MoCA Practice', 'Hebrew version cognitive assessment');
        }

        function practiceBeers() {
            showNotification('‚öóÔ∏è Beers Criteria Quiz', '2023 updates with Israeli context');
        }

        // Progress Management
        function updateProgress(increment) {
            let currentProgress = parseInt(localStorage.getItem('studyProgress') || '25');
            currentProgress = Math.min(100, currentProgress + increment);
            localStorage.setItem('studyProgress', currentProgress);
            
            document.getElementById('progressBar').style.width = currentProgress + '%';
        }

        // Notification System
        function showNotification(title, message) {
            // Try to use native notifications if permitted
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(title, {
                    body: message,
                    icon: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIj4KPHJlY3Qgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiIGZpbGw9IiM2NjdlZWEiLz4KPHR5ZCB4PSIyNTYiIHk9IjI1NiIgdGV4dEFuY2hvcj0ibWlkZGxlIiBmaWxsPSJ3aGl0ZSI+SFJELzwvdGV4dD4KPC9zdmc+'
                });
            }
            
            // Fallback: Custom notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(45deg, #11998e, #38ef7d);
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 10000;
                max-width: 300px;
                opacity: 0;
                transform: translateX(100%);
                transition: all 0.3s ease;
            `;
            
            notification.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 5px;">${title}</div>
                <div style="font-size: 0.9em;">${message}</div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        // Request notification permission
        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        showNotification('üîî Notifications Enabled', 'You\'ll get study reminders and progress updates');
                    }
                });
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved progress
            const savedProgress = localStorage.getItem('studyProgress') || '25';
            document.getElementById('progressBar').style.width = savedProgress + '%';
            
            // Show welcome notification
            setTimeout(() => {
                showNotification('ü§ñ Geriatrics System Ready', 'Standalone app with offline access');
                requestNotificationPermission();
            }, 1000);
            
            // Auto-show PWA prompt if not already installed
            if (!window.matchMedia('(display-mode: standalone)').matches) {
                showPWAPrompt();
            }
        });

        // Handle app install
        window.addEventListener('appinstalled', () => {
            showNotification('‚úÖ App Installed Successfully!', 'Access from your home screen');
        });

        // Detect if running as PWA
        if (window.matchMedia('(display-mode: standalone)').matches) {
            document.querySelector('.install-banner').style.display = 'none';
        }
    </script>
</body>
</html>